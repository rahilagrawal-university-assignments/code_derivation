\documentclass[a4paper,12pt,fleqn]{scrartcl}
\usepackage[l2tabu,orthodox]{nag}% Old habits die hard. All the same, there are commands, classes and packages which are outdated and superseded. nag provides routines to warn the user about the use of those.
\usepackage[all,error]{onlyamsmath}% Error on deprecated math commands like $$ $$.
\usepackage{fixltx2e}
\usepackage[strict=true]{csquotes}
\usepackage{listings}
\lstset{frame=single,framerule=0pt,language={C},showstringspaces=false,numbers=left,columns=fullflexible}
\usepackage{color}
\usepackage{2111defs2,2111theorems}
\usepackage{nicefrac}


\newcommand{\singlequote}[1]{`#1'}
\newcommand{\myjustification}[2][\Equiv]{{}#1{} &{\bcolor\langle\text{#2}\rangle}\\}
\newcommand{\remark}[1]{{\sffamily\color{blue}{#1}}}
\newcommand{\myImplies}[2]{\color{red}#1\color{blue}\Implies\color{red}#2\color{black}}
\newcommand{\pre}{\mathit{pre}}
\newcommand{\post}{\mathit{post}}
\newcommand{\emirp}{\textsc{emirp}\xspace}
\newcommand{\myRefines}[2]{\color{red}{#1}\color{black}\isrefinedby\color{red}{#2}}

\title{Assignment 2 - Emirps}
\date{COMP2111 18s1}
\author{Rahil Agrawal z5165505\\Aditya Karia zXXXXXXX}

\begin{document}
\pagenumbering{gobble}
\maketitle
\pagenumbering{Roman}

\section{Task 1 - Specification Statement}
\label{sec,x:task-1}
\remark{Notes,x:\\-Write neatly\\-make sure grammar is correct\\-look at examples for default spec structure.}\\\\
\remark{Define an Emirp using 2 functions - reverse and prime. Make these functions match with their given specs in order to help prove implications.}\\\\
Pre condition,x: $n$ is a positive number - $n>0$\\\\
Post condition $EMIRP(r,n)$ where $r$ is the $n^{th}$ emirp(where emirp is as defined above).
Therefore our program can be specified by,x:\\
$\PROC~\emirp(\VALUE~n, \RESULT~r)\cdot{}\\
 \qquad  \nt{n,r,x:\left[
    \begin{array}{l}
      n>0, Emirp(r,n)
    \end{array}
  \right]}{(1)}\\$

\section{Task 2 - Derivation}
\label{sec,x:task-1}
\begin{align*}
  &\PROC~\emirp(\VALUE~n, \RESULT~r)\cdot{}
  \nt{n,r,x:\left[
    \begin{array}{l}
      n>0, Emirp(r,n)
    \end{array}
  \right]}{(1)}\\
% 
  \lrefstep{(1)}
  {\textbf{c-frame}}
  {
  \nt{r,x:\left[
    \begin{array}{l}
      n>0, Emirp(r,n)
    \end{array}
  \right]}{(2)}}\\
%
  \lrefstep{(2)}
  {\textbf{i-loc}}
  {
  \nt{i,r,x:\left[
    \begin{array}{l}
      n>0, Emirp(r,n)
    \end{array}
  \right]}{(3)}}\\
%
  \lrefstep{(3)}
  {\textbf{seq}}
  {
  \nt{i,x,r:\left[
    \begin{array}{l}
      n>0, i=1 \And x=13 \And n>0
    \end{array}
  \right]}{(4)};\\
  &\nt{i,x:\left[
    \begin{array}{l}
      i=1 \And x=13 \And n>0, Emirp(r,n)
    \end{array}
  \right]}{(5)}}\\
%
  \lrefstep{(4)}
  {\textbf{c-frame}}
  {
  i,x:\left[
    \begin{array}{l}
      n>0, i=1 \And x=13 \And n>0
    \end{array}
  \right]}\\
%
  \refstep{\textbf{ass - \color{blue}(1)}}
  {i\Ass 1\\
  &x\Ass 13}\\
%
  \lrefstep{(5)}
  {\textbf{seq}}
  {
  \nt{i,r,x:\left[
    \begin{array}{l}
      i=1 \And n>0, Inv
    \end{array}
  \right]}{(6)};\\
  &\nt{i,r,x:\left[
    \begin{array}{l}
      Inv, Inv \And i=n
    \end{array}
  \right]}{(7)};\\
  &\nt{i,r,x:\left[
    \begin{array}{l}
      Inv \And i=n, Emirp(r,n)
    \end{array}
  \right]}{(8)}}\\
%
  \lrefstep{(6)}
  {\textbf{w-pre, c-frame - \color{blue}(2)}}
  {r,x:\left[
    \begin{array}{l}
      Inv\subst{13}{x}, Inv
    \end{array}
  \right]}\\
%
  \refstep{\textbf{ass - \color{blue}(3)}}
  {r\Ass 13}\\
%
  \lrefstep{(7)}
  {\textbf{while}}
  {
  \WHILE~i\neq n~\DO\\
  &\qquad \nt{i,r,x:\left[
    \begin{array}{l}
      Inv\And i\neq n, Inv
    \end{array}
  \right]}{(9)}\\
  &\OD;}\\
%
  \lrefstep{(8)}
  {\textbf{w-pre, c-frame - \color{blue}(4) }}
  {
  \nt{r,x:\left[
    \begin{array}{l}
      \emirp(r,n), \emirp(r,n)
    \end{array}
  \right]}{(10)}}\\
%
  \refstep{\textbf{skip - \color{blue}(5)}}
  {skip}\\
%
  \lrefstep{(9)}
  {\textbf{seq}}
  {
  \nt{r,x:\left[
    \begin{array}{l}
      Inv\And i\neq n, Inv\subst{x+1}{x}
    \end{array}
  \right]}{(10)};\\
  &\nt{r,x:\left[
    \begin{array}{l}
      Inv\subst{x+1}{x}, Inv
    \end{array}
  \right]}{(11)}}\\
\end{align*}
\begin{align*}
  \lrefstep{(10)}
  {\textbf{ass - \color{blue}(6)}}
  {x\Ass{x+1}}\\
%
  \lrefstep{(11)}
  {\textbf{i-loc, seq}}
  {
  \nt{a,i,r,x:\left[
    \begin{array}{l}
      Inv\subst{x+1}{x}, Inv\subst{x+1}{x}\And a=1
    \end{array}
  \right]}{(12)};\\
  &\nt{a,i,r,x:\left[
    \begin{array}{l}
      Inv\subst{x+1}{x}\And a=1, Inv
    \end{array}
  \right]}{(13)}
  }\\
%
  \lrefstep{(12)}
  {\textbf{c-frame}}
  {
  a,x:\left[
    \begin{array}{l}
      Inv\subst{x+1}{x}, Inv\subst{x+1}{x}\And a=1  
    \end{array}
  \right]}\\
%
  \refstep{\textbf{ass - \color{blue}(7)}}
  {a\Ass 1}\\
%
  \lrefstep{(13)}
  {\textbf{seq}}
  {
  \nt{a,i,r,x:\left[
    \begin{array}{l}
      Inv\subst{x+1}{x}\And a=1 ,(a=1 \text{ }\And \neg\Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})\\
      \Or(a=0 \And \Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0}))
    \end{array}
  \right]}{(14)};\\
  &\nt{a,i,r,x:\left[
    \begin{array}{l}
      (a=1 \text{ }\And \neg\Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})\\\Or(a=0 \And \Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})),
      Inv
    \end{array}
  \right]}{(15)}
  }\\
%
  \lrefstep{(14)}
  {\textbf{w-pre - \color{blue}(8)}}
  {
  a,x:\left[
    \begin{array}{l}
      a>1\And x>0, post(14)  
    \end{array}
  \right]}\\
%
  \refstep{\textbf{proc}}{
    isPrime(x,a)
  }\\
%
  \lrefstep{(15)}{\textbf{if}}
  {\IF~a=1\\
  &\THEN~\nt{a,i,r,x:[a=1\And\pre(15),\post(15)]}{(16)}\\
  &\ELSE~\nt{p,x:[a\neq1\And\pre(15),\post(15)]}{(17)}\\
  &\FI}\\
%
  \lrefstep{(16)}
  {\textbf{i-loc}}
  {
  a,i,r,s,x:\left[
    \begin{array}{l}
      \pre(16), \post(16)  
    \end{array}
  \right]}\\
%
  \refstep{\textbf{seq}}
  {
  \nt{s,x:\left[
    \begin{array}{l}
      \pre(16), s=0
    \end{array}
  \right]}{(18)};\\
  &\nt{a,i,r,s,x: \left[
    \begin{array}{l}
      s=0, \post(16)
    \end{array}
  \right]}{(19)}}\\
%
\lrefstep{(17)}{\textbf{c-frame, w-pre- \color{blue}(9)}}
  {
  i,r:\left[
    \begin{array}{l}
        Inv, Inv
    \end{array}\right]}\\
%
  \refstep{\textbf{ass - \color{blue}(10)}}
  {skip}\\
%
  \lrefstep{(18)}{\textbf{ass - \color{blue}(11)}}
  {s\Ass 0}\\  
%
  \lrefstep{(19)}{\textbf{seq}}
  {
  \nt{s,x:\left[
    \begin{array}{l}
      \pre(19), \textrm{\remark{reversen function post condition}}
    \end{array}
  \right]}{(20)};\\
  &\nt{a,i,r,s,x: \left[
    \begin{array}{l}
      \textrm{\remark{reversen function post condition}}, \post(19)
    \end{array}
  \right]}{(21)}}\\
\end{align*}
\begin{align*}
  \lrefstep{(20)}{\textbf{w-pre - \color{blue}(12)}}
  {
  s,x:\left[
    \begin{array}{l}
      \textrm{\remark{reverse function pre condition}}, \textrm{\remark{reversen function post condition}}
    \end{array}
  \right]}\\
%
  \refstep{\textbf{proc}}
  {reversen(x,s)}\\
%
  \lrefstep{(21)}
  {\textbf{i-loc, seq}}
  {
  \nt{a,i,r,s,b,x:\left[
    \begin{array}{l}
      \pre(21), \pre(21)\And b=1  
    \end{array}
  \right]}{(22)};\\
  &\nt{a,i,r,s,b,x:\left[
    \begin{array}{l}
      \pre(21)\And b=1, \post(21)  
    \end{array}
  \right]}{(23)}}\\
%
  \lrefstep{(22)}{\textbf{c-frame, ass - \color{blue}(13)}}
   {
     b\Ass 1 
   }\\
%
  \lrefstep{(23)}{\textbf{seq}}
  {
  \nt{a,i,r,s,b,x:\left[
    \begin{array}{l}
        pre(21) \And b = 1, (a=1 \text{ }\And \neg\Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})\\
      \Or(a=0 \And \Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})
    \end{array}
  \right]}{(24)};\\
  &\nt{a,i,r,s,b,x:\left[
    \begin{array}{l}
        (a=1 \text{ }\And \neg\Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})\\
      \Or(a=0 \And \Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0}) , post(21)
    \end{array}
  \right]}{(25)}}\\
%
  \lrefstep{(24)}{\textbf{w-pre - \color{blue}{(14)}}}
  {a,i,r,s,b,x:\left[
    \begin{array}{l}
        s>0 \And b=1, (a=1 \text{ }\And \neg\Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})\\
      \Or(a=0 \And \Exi{k \in 2..(x-1)}{x\textbf{ mod }k=0})
    \end{array}\right]}\\
%
  \refstep{\textbf{proc}}{
    isPrime(x,a)
  }\\
%
  \lrefstep{(25)}{\textbf{if}}
  {
  \IF~b=1 \And s\neq x\\
  &\THEN~\nt{i,x:[b=1\And s\neq x \And\pre(25),\post(25)]}{(26)}\\
  &\ELSE~\nt{i,r,a,s,b,x:[(b\neq1 \Or s=x)\And\pre(25),\post(25)]}{(27)}\\
  &\FI
  }\\
%
  \lrefstep{(26)}{\textbf{c-frame, w-pre- \color{blue}(15)}}
  {
  a,i,r,s,b,x:\left[
    \begin{array}{l}
        Inv\subst{i+1}{i}\subst{x}{r}, Inv
    \end{array}\right]}\\
%
  \refstep{\textbf{ass - \color{blue}(16)}}
  {
    i\Ass i+1\\
    &r\Ass r\\
  }\\
%
  \lrefstep{(27)}{\textbf{c-frame, w-pre- \color{blue}(17)}}
  {
  a,i,r,s,b,x:\left[
    \begin{array}{l}
        Inv, Inv
    \end{array}\right]}\\
%
  \refstep{\textbf{ass - \color{blue}(18)}}
  {
    skip
  }\\
\end{align*}
We gather the code for the procedure body of $\emirp$,x:
\begin{tabbing}% unfortunately, tabbing doesn't do maths
\end{tabbing}
We have derived our code. However we need to prove \textbf{\color{blue}some }\color{black} refinements.
\subsection{\color{blue}Implication 1\color{black}: $\myRefines{(4)}{i\Ass 1}$}

\begin{align*}
  &K\And i\geq1 \And a[i][l]=a[i-1][l] \And j=1 \And a[i][l]=0\\
  %
  \myjustification[\Implies]{$K\And B\And C\And D\And E\Implies K\And C\And E$.Expanding K}
  % 
  &I \And j\in (0,1) \And l\in 0..y, a[i][y]=0 \And \All{w\in 0..(l-1)}{a[i][w]=a[i-1][w]} \And\\
  &a[i][l]=a[i-1][l] \And a[i][l]=0\\
  %
  \myjustification[\Implies]{since true for $w$ in 0..l-1 and also for l}
  %
  &I \And j\in (0,1) \And l\in 0..y, a[i][y]=0 \And \All{w\in 0..l}{a[i][w]=a[i-1][w] \And a[i][l]=0}\\
  %
  \myjustification[\Implies]{separating for $l$ in 0..y-1 and l=y}
  %
  &I \And j\in (0,1) \And l\in 0..y-1, a[i][y]=0 \And \All{w\in 0..l}{a[i][w]=a[i-1][w]} \And a[i][l]=0 \OR\\
  &I \And j\in (0,1) \And l=y\And a[i][l]=0, a[i][y]=0 \And \All{w\in 0..l}{a[i][w]=a[i-1][w]}\\
  %
  \myjustification[\Implies]{since a[i][l] = a[i][y] = 0 when l=y}
  %
  &I \And j\in (0,1) \And l\in 0..y-1, a[i][y]=0 \And \All{w\in 0..l}{a[i][w]=a[i-1][w]} \Or TRUE\\
  %
  \myjustification{definitions of $I$ and substitution , $l$ in 0..y-1 means (l+1) in 0..y }
  %
  &K\subst {l+1}l\subst 0j
\end{align*}



\section{Task 3 - C Code}
\label{sec,x:task-1}
\lstinputlisting{emirp.c}
\remark{- Write something about how the C code relates.\\- Compare with examples}
\end{document}
